# 项目文件结构图

**项目**: HTNet增强版面瘫识别系统  
**更新日期**: 2024-10-28

---

## 📂 完整目录结构

```
HTNet/
│
├── 📘 入口和导航文档
│   ├── START_HERE.md                          ⭐ 新用户从这里开始
│   ├── DOCUMENTATION_INDEX.md                 📚 完整文档索引
│   ├── 改进清单.md                            📋 快速参考清单
│   └── 文件结构图.md                          📂 本文档
│
├── 📗 核心问答文档
│   ├── USER_QUESTION_ANSWER.md                ❓ 直接回答用户问题
│   ├── FEASIBILITY_ANSWER_CN.md               ✅ 详细可行性分析
│   └── QUICK_START_ENHANCED.md                🚀 5分钟快速入门
│
├── 📕 技术详细文档
│   ├── README_ENHANCED_MODULES.md             📖 完整技术文档
│   ├── FEATURE_DIAGONAL_MICRO_ATTENTION_ROI.md 🔬 功能特性分析
│   └── IMPLEMENTATION_SUMMARY.md              📊 实现总结（英文）
│
├── 📙 汇总文档
│   └── ALL_IMPROVEMENTS_SUMMARY.md            📑 所有改进的详细汇总
│
├── 📓 主项目文档
│   ├── README.md                              📘 主README（英文，已更新）
│   ├── README_CN.md                           📘 主README（中文，已更新）
│   ├── README_FACIAL_PALSY.md                 📘 面瘫识别文档
│   ├── CHANGELOG.md                           📝 变更日志
│   └── MIGRATION_SUMMARY.md                   📝 迁移总结
│
├── 🐍 核心代码文件
│   ├── Model.py                               ⭐⭐⭐ 主模型文件（已更新）
│   │   ├── DiagonalMicroAttention             🆕 对角微注意力（46-130行）
│   │   ├── ROIAttentionModule                 🆕 ROI注意力（132-191行）
│   │   ├── EnhancedTransformer                🆕 增强Transformer（255-304行）
│   │   ├── HTNetEnhanced                      🆕 增强HTNet（373-454行）
│   │   ├── HTNet                              原始HTNet
│   │   └── Fusionmodel                        融合模型
│   │
│   ├── facial_palsy_dataset.py                📊 数据集加载器
│   ├── train_facial_palsy.py                  🏋️ 基础训练脚本
│   ├── evaluate_facial_palsy.py               📈 评估脚本
│   ├── prepare_dataset.py                     🔧 数据准备
│   ├── data_augmentation.py                   🔄 数据增强
│   ├── visualize_attention.py                 👁️ 注意力可视化
│   └── demo_inference.py                      🎬 推理演示
│
├── 🛠️ 增强模块工具（新增）
│   ├── train_enhanced_facial_palsy.py         🆕⭐ 增强模型训练（327行）
│   ├── visualize_roi_and_asymmetry.py         🆕⭐ ROI和不对称可视化（281行）
│   ├── test_enhanced_model.py                 🆕⭐ 测试套件（273行）
│   └── check_syntax.py                        🆕⭐ 语法检查（53行）
│
├── ⚙️ 配置文件
│   ├── .gitignore                             🔧 Git忽略配置（已更新+74行）
│   ├── requirements.txt                       📦 依赖列表
│   └── config_examples.yaml                   📝 配置示例
│
├── 📁 数据目录（被忽略）
│   └── datasets/
│       ├── facial_palsy/
│       │   ├── FNP/                           面神经麻痹数据集
│       │   └── CK+/                           CK+数据集
│       ├── CASME_II/                          微表情数据集
│       ├── SAMM/                              微表情数据集
│       └── SMIC/                              微表情数据集
│
├── 💾 输出目录（被忽略）
│   ├── checkpoints/                           模型检查点
│   │   ├── enhanced/                          🆕 增强模型检查点
│   │   └── baseline/                          基准模型检查点
│   │
│   ├── logs/                                  训练日志
│   │   ├── enhanced/                          🆕 增强模型日志
│   │   └── baseline/                          基准模型日志
│   │
│   └── visualizations/                        可视化输出
│       ├── roi_asymmetry/                     🆕 ROI和不对称可视化
│       └── attention/                         注意力可视化
│
└── 🖼️ 资源文件
    └── images/
        ├── micro-architecture.png             架构图
        ├── datasets.png                       数据集图
        └── state_of_art.png                   性能对比图
```

---

## 📊 文件分类统计

### 按类型分类

| 类型 | 数量 | 说明 |
|------|------|------|
| 📘 入口和导航文档 | 4个 | 引导和索引 |
| 📗 核心问答文档 | 3个 | 回答用户问题 |
| 📕 技术详细文档 | 3个 | 深入技术说明 |
| 📙 汇总文档 | 1个 | 综合汇总 |
| 📓 主项目文档 | 5个 | 项目基础文档 |
| 🐍 核心代码 | 8个 | 模型和工具 |
| 🛠️ 增强工具 | 4个 | 🆕 新增工具 |
| ⚙️ 配置文件 | 3个 | 项目配置 |

### 按状态分类

| 状态 | 数量 | 文件 |
|------|------|------|
| 🆕 新增 | 15个 | 11文档 + 4脚本 |
| ✏️ 更新 | 3个 | README.md, README_CN.md, .gitignore |
| 📦 保持 | 若干 | 原有文件 |

---

## 🎯 核心文件详解

### Model.py - 主模型文件 ⭐⭐⭐⭐⭐

```
Model.py (478行)
│
├── 基础组件（原有）
│   ├── LayerNorm                   (12-22行)
│   ├── PreNorm                     (24-31行)
│   ├── FeedForward                 (33-44行)
│   └── Attention                   (193-223行)
│
├── 🆕 增强模块（新增）
│   ├── DiagonalMicroAttention      (46-130行)
│   │   ├── compute_diagonal_attention()
│   │   ├── detect_left_right_asymmetry()
│   │   └── forward()
│   │
│   └── ROIAttentionModule          (132-191行)
│       ├── roi_detector
│       ├── spatial_attention
│       ├── channel_attention
│       ├── background_suppressor
│       └── roi_refine
│
├── Transformer组件
│   ├── Aggregate                   (225-230行)
│   ├── Transformer                 (232-253行)
│   └── 🆕 EnhancedTransformer      (255-304行)
│
└── 完整模型
    ├── HTNet                       (306-371行)
    ├── 🆕 HTNetEnhanced            (373-454行)
    └── Fusionmodel                 (456-477行)
```

---

## 📚 文档阅读路径

### 路径1: 快速了解（15分钟）⚡

```
START_HERE.md (5分钟)
    ↓
USER_QUESTION_ANSWER.md (5分钟)
    ↓
QUICK_START_ENHANCED.md (5分钟)
    ↓
开始使用！
```

### 路径2: 深入学习（45分钟）📖

```
USER_QUESTION_ANSWER.md (5分钟)
    ↓
FEASIBILITY_ANSWER_CN.md (20分钟)
    ↓
README_ENHANCED_MODULES.md (20分钟)
    ↓
实验和调优
```

### 路径3: 技术研究（90分钟）🔬

```
IMPLEMENTATION_SUMMARY.md (15分钟)
    ↓
FEATURE_DIAGONAL_MICRO_ATTENTION_ROI.md (25分钟)
    ↓
README_ENHANCED_MODULES.md (30分钟)
    ↓
Model.py 源码阅读 (20分钟)
    ↓
深入研究和改进
```

### 路径4: 实战开发（60分钟）💻

```
QUICK_START_ENHANCED.md (10分钟)
    ↓
README_ENHANCED_MODULES.md (20分钟)
    ↓
python test_enhanced_model.py (10分钟)
    ↓
训练模型 (20分钟)
    ↓
生产环境部署
```

---

## 🔧 工具脚本关系图

```
工具脚本生态系统
│
├── 验证工具
│   └── check_syntax.py
│       ├─→ 检查 Model.py
│       ├─→ 检查 train_enhanced_facial_palsy.py
│       ├─→ 检查 visualize_roi_and_asymmetry.py
│       └─→ 检查 test_enhanced_model.py
│
├── 测试工具
│   └── test_enhanced_model.py
│       ├─→ 测试 DiagonalMicroAttention
│       ├─→ 测试 ROIAttentionModule
│       ├─→ 测试 EnhancedTransformer
│       └─→ 测试 HTNetEnhanced
│
├── 训练工具
│   └── train_enhanced_facial_palsy.py
│       ├─→ 加载数据（facial_palsy_dataset.py）
│       ├─→ 创建模型（HTNetEnhanced）
│       ├─→ 训练循环
│       └─→ 保存检查点
│
└── 可视化工具
    └── visualize_roi_and_asymmetry.py
        ├─→ 加载模型
        ├─→ 生成ROI图
        ├─→ 生成不对称热图
        └─→ 保存可视化结果
```

---

## 📦 模块依赖关系

```
HTNetEnhanced
    │
    ├── 使用 EnhancedTransformer
    │       │
    │       ├── 使用 Attention（原有）
    │       │
    │       ├── 使用 DiagonalMicroAttention（新增）
    │       │       ├── 对角线注意力
    │       │       └── 不对称检测
    │       │
    │       └── 使用 ROIAttentionModule（新增）
    │               ├── ROI检测器
    │               ├── 空间注意力
    │               ├── 通道注意力
    │               └── 背景抑制
    │
    └── 使用 Aggregate（原有）
```

---

## 🎨 可视化输出结构

```
visualizations/
└── roi_asymmetry/
    ├── sample_001.png
    │   ├─ [子图1] 原始图像 + 预测
    │   ├─ [子图2] 左侧面部
    │   ├─ [子图3] 右侧面部
    │   ├─ [子图4] 不对称热图
    │   ├─ [子图5] ROI区域1（前额）
    │   ├─ [子图6] ROI区域2（左眼）
    │   ├─ [子图7] ROI区域3（鼻子）
    │   ├─ [子图8] ROI区域4（右眼）
    │   ├─ [子图9] ROI区域5（嘴部）
    │   ├─ [子图10] ROI综合注意力
    │   └─ [子图11] 背景抑制图
    │
    ├── sample_002.png
    ├── sample_003.png
    └── ...
```

---

## 🗂️ 数据流向图

```
训练流程
│
输入: 面部图像
    ↓
[facial_palsy_dataset.py] 数据加载和预处理
    ↓
[Model.py] 特征提取
    ├─→ Patch Embedding
    ├─→ EnhancedTransformer层
    │   ├─→ Attention（全局）
    │   ├─→ DiagonalMicroAttention（对角+不对称）
    │   └─→ ROIAttentionModule（ROI+背景抑制）
    └─→ MLP分类头
    ↓
输出: 面瘫等级 + ROI图
    ↓
[train_enhanced_facial_palsy.py] 损失计算和反向传播
    ↓
[visualize_roi_and_asymmetry.py] 可视化分析
    ↓
保存: 模型检查点 + 可视化图像
```

---

## 📋 文件大小统计

### 代码文件

| 文件 | 行数 | 状态 |
|------|------|------|
| Model.py | 478 | ✏️ 更新（+200）|
| train_enhanced_facial_palsy.py | 327 | 🆕 新增 |
| visualize_roi_and_asymmetry.py | 281 | 🆕 新增 |
| test_enhanced_model.py | 273 | 🆕 新增 |
| check_syntax.py | 53 | 🆕 新增 |
| **总计** | **1,412** | **934新增** |

### 文档文件

| 文件 | 大小 | 状态 |
|------|------|------|
| ALL_IMPROVEMENTS_SUMMARY.md | 大 | 🆕 新增 |
| README_ENHANCED_MODULES.md | 11KB | 🆕 新增 |
| IMPLEMENTATION_SUMMARY.md | 10KB | 🆕 新增 |
| FEASIBILITY_ANSWER_CN.md | 9.0KB | 🆕 新增 |
| FEATURE_DIAGONAL_MICRO_ATTENTION_ROI.md | 8.9KB | 🆕 新增 |
| DOCUMENTATION_INDEX.md | 8.0KB | 🆕 新增 |
| USER_QUESTION_ANSWER.md | 7.0KB | 🆕 新增 |
| QUICK_START_ENHANCED.md | 6.2KB | 🆕 新增 |
| START_HERE.md | 3.5KB | 🆕 新增 |
| 改进清单.md | 中 | 🆕 新增 |
| 文件结构图.md | 中 | 🆕 新增 |
| README.md | - | ✏️ 更新 |
| README_CN.md | - | ✏️ 更新 |
| **总计** | **~70KB** | **11新增+2更新** |

---

## 🎯 关键路径

### 从零开始使用

```
1. 克隆仓库
   git clone <repo_url>
   cd HTNet
   
2. 阅读入口文档
   cat START_HERE.md
   
3. 快速入门
   cat QUICK_START_ENHANCED.md
   
4. 检查环境
   python check_syntax.py
   
5. 运行测试
   python test_enhanced_model.py
   
6. 准备数据
   python prepare_dataset.py
   
7. 训练模型
   python train_enhanced_facial_palsy.py
   
8. 可视化结果
   python visualize_roi_and_asymmetry.py
```

### 理解实现

```
1. 阅读问答
   cat USER_QUESTION_ANSWER.md
   
2. 了解可行性
   cat FEASIBILITY_ANSWER_CN.md
   
3. 学习技术细节
   cat README_ENHANCED_MODULES.md
   
4. 查看源码
   less Model.py
   
5. 运行测试
   python test_enhanced_model.py
```

---

## 🔍 文件查找快速索引

### 按功能查找

| 需求 | 查看文件 |
|------|---------|
| **快速开始** | START_HERE.md |
| **回答可行性** | USER_QUESTION_ANSWER.md |
| **5分钟入门** | QUICK_START_ENHANCED.md |
| **详细分析** | FEASIBILITY_ANSWER_CN.md |
| **技术文档** | README_ENHANCED_MODULES.md |
| **功能特性** | FEATURE_DIAGONAL_MICRO_ATTENTION_ROI.md |
| **实现总结** | IMPLEMENTATION_SUMMARY.md |
| **文档索引** | DOCUMENTATION_INDEX.md |
| **完整汇总** | ALL_IMPROVEMENTS_SUMMARY.md |
| **快速参考** | 改进清单.md |
| **文件结构** | 文件结构图.md（本文档）|

### 按代码功能查找

| 需求 | 查看文件 |
|------|---------|
| **模型定义** | Model.py |
| **训练脚本** | train_enhanced_facial_palsy.py |
| **可视化** | visualize_roi_and_asymmetry.py |
| **测试** | test_enhanced_model.py |
| **语法检查** | check_syntax.py |

---

## 📊 统计总结

### 新增内容

- 🆕 代码文件: 4个（934行）
- 🆕 核心类: 4个
- 🆕 文档文件: 11个（~70KB）
- ✏️ 更新文件: 3个

### 文档体系

- 📘 入口文档: 4个
- 📗 问答文档: 3个
- 📕 技术文档: 3个
- 📙 汇总文档: 2个
- 📓 项目文档: 5个（2个更新）

### 工具生态

- 🔧 训练工具: 1个
- 👁️ 可视化工具: 1个
- 🧪 测试工具: 1个
- ✅ 验证工具: 1个

---

**最后更新**: 2024-10-28  
**维护状态**: ✅ 活跃  
**完成度**: 100%
